{"version":3,"file":"pages/index/index.js","sources":["webpack:///./component/ActionLocker.js","webpack:///./api/article.js","webpack:///./pages/index/index.vue?c3f2","webpack:///./pages/index/index.vue","webpack:///./pages/index/index.vue?bbcc","webpack:///./pages/index/index.vue?6d7e"],"sourcesContent":["export default class ActionLocker{\r\n  constructor(element){\r\n    this.element=element;\r\n    this.lock();\r\n  }\r\n  lock(){\r\n    this.element.disabled=true;\r\n  }\r\n  unlock(){\r\n    this.element.disabled=false;\r\n  }\r\n}","import {request} from '@/plugins/request';\r\n\r\n/**\r\n * \r\n * @param {tag?,auther?,favorited?,limit?,offset?} params \r\n * @returns \r\n */\r\nexport const getArticle = params=>{\r\n  return request({\r\n    method:'GET',\r\n    url:'/api/articles',\r\n    params\r\n  });\r\n}\r\nexport const getFeedArticle = params=>{\r\n  return request({\r\n    method:'GET',\r\n    url:'/api/articles/feed',\r\n    params\r\n  }).catch(e=>console.dir(e));\r\n}\r\nexport const getTags = ()=>{\r\n  return request({\r\n    method:'GET',\r\n    url:'/api/tags'\r\n  });\r\n}\r\nexport const addFav = slug => {\r\n  return request({\r\n    method:'POST',\r\n    url:`/api/articles/${slug}/favorite`\r\n  });\r\n}\r\nexport const delFav = slug => {\r\n  return request({\r\n    method:'DELETE',\r\n    url:`/api/articles/${slug}/favorite`\r\n  });\r\n}\r\nexport const articleDetail = slug=>{\r\n  return request({\r\n    method:'GET',\r\n    url:`/api/articles/${slug}`\r\n  });\r\n}\r\nexport const getComments = slug=>{\r\n  return request({\r\n    method:'GET',\r\n    url:`/api/articles/${slug}/comments`\r\n  });\r\n}\r\nexport const addComments = (slug,body)=>{\r\n  return request({\r\n    method:'POST',\r\n    url:`/api/articles/${slug}/comments`,\r\n    data:{\r\n      comment:{body}\r\n    }\r\n  });\r\n}\r\nexport const delComments = (slug,commentid) => {\r\n  return request({\r\n    method:'DELETE',\r\n    url:`/api/articles/${slug}/comments/${commentid}`\r\n  });\r\n}\r\nexport const addArticle = (article)=>{\r\n  return request({\r\n    method:'POST',\r\n    url:`/api/articles`,\r\n    data:{\r\n      article\r\n    }\r\n  });\r\n}","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"home-page\"},[_vm._ssrNode(\"<div class=\\\"banner\\\"><div class=\\\"container\\\"><h1 class=\\\"logo-font\\\">conduit</h1> <p>A place to share your knowledge.</p></div></div> \"),_vm._ssrNode(\"<div class=\\\"container page\\\">\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"row\\\">\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"col-md-9\\\">\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"feed-toggle\\\">\",\"</div>\",[_vm._ssrNode(\"<ul class=\\\"nav nav-pills outline-active\\\">\",\"</ul>\",[(_vm.user)?_vm._ssrNode(\"<li class=\\\"nav-item\\\">\",\"</li>\",[_c('nuxt-link',{staticClass:\"nav-link\",class:{ active: _vm.tab === 'your_feed' },attrs:{\"to\":'/?tab=your_feed',\"exact\":\"\"}},[_vm._v(\"Your Feed\")])],1):_vm._e(),_vm._ssrNode(\" \"),_vm._ssrNode(\"<li class=\\\"nav-item\\\">\",\"</li>\",[_c('nuxt-link',{staticClass:\"nav-link\",class:{ active: _vm.tab === 'global_feed' },attrs:{\"to\":'/?tab=global_feed',\"exact\":\"\"}},[_vm._v(\"Global Feed\")])],1),_vm._ssrNode(\" \"),(_vm.tag)?_vm._ssrNode(\"<li class=\\\"nav-item\\\">\",\"</li>\",[_c('nuxt-link',{staticClass:\"nav-link\",class:{ active: _vm.tab === 'tag' },attrs:{\"to\":'/?tab=tag&tag=' + _vm.tag,\"exact\":\"\"}},[_vm._v(\"#\"+_vm._s(_vm.tag))])],1):_vm._e()],2)]),_vm._ssrNode(\" \"),_vm._l((_vm.articles),function(article){return _vm._ssrNode(\"<div class=\\\"article-preview\\\">\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"article-meta\\\">\",\"</div>\",[_c('nuxt-link',{attrs:{\"to\":{ path: '/profile/' + article.author.username }}},[_c('img',{attrs:{\"src\":article.author.image}})]),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div class=\\\"info\\\">\",\"</div>\",[_c('nuxt-link',{staticClass:\"author\",attrs:{\"to\":{ path: '/profile/' + article.author.username }}},[_vm._v(_vm._s(article.author.username))]),_vm._ssrNode(\" <span class=\\\"date\\\">\"+_vm._ssrEscape(_vm._s(_vm._f(\"datetime\")(article.createdAt,\"MMM DD,YYYY\")))+\"</span>\")],2),_vm._ssrNode(\" <button\"+(_vm._ssrClass(\"btn btn-outline-primary btn-sm pull-xs-right\",{ active: article.favorited }))+\"><i class=\\\"ion-heart\\\"></i>\"+_vm._ssrEscape(\" \"+_vm._s(article.favoritesCount)+\"\\n            \")+\"</button>\")],2),_vm._ssrNode(\" \"),_c('nuxt-link',{staticClass:\"preview-link\",attrs:{\"to\":'/article/' + article.slug}},[_c('h1',[_vm._v(_vm._s(article.title))]),_vm._v(\" \"),_c('p',[_vm._v(_vm._s(article.description))]),_vm._v(\" \"),_c('span',[_vm._v(\"Read more...\")])])],2)}),_vm._ssrNode(\" \"),_vm._ssrNode(\"<nav>\",\"</nav>\",[_vm._ssrNode(\"<ul class=\\\"pagination\\\">\",\"</ul>\",_vm._l((_vm.totalPage),function(i){return _vm._ssrNode(\"<li\"+(_vm._ssrClass(\"page-item\",{ active: _vm.page === i }))+\">\",\"</li>\",[_c('nuxt-link',{staticClass:\"page-link ng-binding\",attrs:{\"to\":'/?page=' + i + '&tab=' + _vm.tab + (_vm.tag ? '&tag=' + _vm.tag : '')}},[_vm._v(_vm._s(i))])],1)}),0)])],2),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div class=\\\"col-md-3\\\">\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"sidebar\\\">\",\"</div>\",[_vm._ssrNode(\"<p>Popular Tags</p> \"),_vm._ssrNode(\"<div class=\\\"tag-list\\\">\",\"</div>\",_vm._l((_vm.tags),function(tag){return _c('nuxt-link',{key:tag,staticClass:\"tag-pill tag-default\",attrs:{\"to\":'/?tag=' + tag + '&tab=tag'}},[_vm._v(_vm._s(tag))])}),1)],2)])],2)])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {\r\n  getArticle,\r\n  getFeedArticle,\r\n  addFav,\r\n  delFav,\r\n  getTags,\r\n} from \"../../api/article\";\r\nimport ActionLocker from \"@/component/ActionLocker\";\r\nimport { mapState } from \"vuex\";\r\nconst limit = 10;\r\nexport default {\r\n  async asyncData(ctx) {\r\n    let page = Number(ctx.query.page) || 1;\r\n    let tag = ctx.query.tag;\r\n    let tab = ctx.query.tab || \"global_feed\";\r\n    let funArticle = tab === \"your_feed\" ? getFeedArticle : getArticle;\r\n    let articlePromise = funArticle({ limit, tag, offset: (page - 1) * limit });\r\n    let tagsPromise = getTags();\r\n    const resp = await articlePromise;\r\n    const data = resp.data;\r\n    const { data: tagData } = await tagsPromise;\r\n    return {\r\n      articles: data.articles,\r\n      articlesCount: data.articlesCount,\r\n      tags: tagData.tags,\r\n      page,\r\n      tag,\r\n      tab,\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapState([\"user\"]),\r\n    totalPage() {\r\n      return Math.ceil(this.articlesCount / limit);\r\n    },\r\n  },\r\n  watchQuery: [\"page\", \"tag\", \"tab\"],\r\n  mounted() {\r\n    console.log(this.$data);\r\n  },\r\n  created() {},\r\n  methods: {\r\n    async onFav(e, article) {\r\n      let lock = new ActionLocker(e.currentTarget);\r\n      try {\r\n        if (!article.favorited) {\r\n          await addFav(article.slug);\r\n          ++article.favoritesCount;\r\n        } else {\r\n          await delFav(article.slug);\r\n          --article.favoritesCount;\r\n        }\r\n        article.favorited = !article.favorited;\r\n      } finally {\r\n        lock.unlock();\r\n      }\r\n    },\r\n  },\r\n};\r\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=ffa9a7ce&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  \"6df5848a\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAXA;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AADA;AAHA;AAOA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAHA;AAOA;;;;;;;;;;;;AC1EA;AACA;AACA;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAMA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAhBA;AA/BA;;AChIA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}